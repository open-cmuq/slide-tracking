{"version":3,"file":"6-3db4466a.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(logged-in)/coverslip/_coverslipId_/files/_page.server.js","../../../.svelte-kit/adapter-node/nodes/6.js"],"sourcesContent":["import { e as error, f as fail } from \"../../../../../../chunks/index.js\";\nimport { d as deleteEntrySchema } from \"../../../../../../chunks/forms.js\";\nimport { F as FILE_UPLOAD_DIR } from \"../../../../../../chunks/env.js\";\nimport { nanoid } from \"nanoid\";\nimport path$1 from \"node:path\";\nimport { p as prisma } from \"../../../../../../chunks/index4.js\";\nimport { a as redirectDifferentRoute } from \"../../../../../../chunks/redirect.js\";\nimport fs from \"fs\";\nimport path from \"path\";\nfunction mkdirp(dir) {\n  try {\n    fs.mkdirSync(dir, { recursive: true });\n  } catch (err) {\n    if (err.code === \"EEXIST\")\n      return;\n    throw err;\n  }\n}\nfunction write(filepath, data) {\n  mkdirp(path.dirname(filepath));\n  fs.writeFileSync(filepath, data);\n}\nfunction load({ locals, params }) {\n  return {\n    files: prisma.coverslipFile.findMany({\n      where: {\n        coverslipId: params.coverslipId,\n        createdByUserId: locals.user.id\n      },\n      include: {\n        createdBy: true\n      }\n    })\n  };\n}\nconst actions = {\n  async new(event) {\n    const { locals, request } = event;\n    const formData = await request.formData();\n    const coverslipId = formData.get(\"coverslipId\");\n    if (typeof coverslipId !== \"string\") {\n      throw error(400);\n    }\n    const files = formData.getAll(\"files\");\n    for (const file of files) {\n      if (typeof file === \"string\") {\n        throw error(400);\n      }\n      const id = nanoid();\n      const filepath = path$1.join(FILE_UPLOAD_DIR, id);\n      const buffer = Buffer.from(await file.arrayBuffer());\n      write(filepath, buffer);\n      await prisma.coverslipFile.create({\n        data: {\n          id,\n          coverslipId,\n          createdByUserId: locals.user.id,\n          name: file.name,\n          size: file.size\n        }\n      }).then(() => {\n        redirectDifferentRoute(event, `/coverslip/${coverslipId}/files`);\n      }).catch((error2) => {\n        console.error(error2);\n      });\n    }\n  },\n  async delete(event) {\n    const formData = Object.fromEntries(await event.request.formData());\n    const deleteParse = deleteEntrySchema.safeParse(formData);\n    if (!deleteParse.success) {\n      return fail(400, deleteParse.error.formErrors);\n    }\n    await prisma.coverslipFile.delete({\n      where: {\n        id: deleteParse.data.id\n      }\n    });\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(logged-in)/coverslip/_coverslipId_/files/_page.server.js';\n\nexport const index = 6;\nexport const component = async () => (await import('../entries/pages/(logged-in)/coverslip/_coverslipId_/files/_page.svelte.js')).default;\nexport const file = '_app/immutable/entry/(logged-in)-coverslip-_coverslipId_-files-page.svelte.5f81a80c.js';\nexport { server };\nexport const server_id = \"src/routes/(logged-in)/coverslip/[coverslipId]/files/+page.server.js\";\nexport const imports = [\"_app/immutable/entry/(logged-in)-coverslip-_coverslipId_-files-page.svelte.5f81a80c.js\",\"_app/immutable/chunks/index.79e82b19.js\",\"_app/immutable/chunks/coverslipTable.svelte_svelte_type_style_lang.6429d3c8.js\",\"_app/immutable/chunks/parse.d12b0d5b.js\",\"_app/immutable/chunks/singletons.d744cbe5.js\",\"_app/immutable/chunks/button-item.6bf52554.js\",\"_app/immutable/chunks/popup.dbbce627.js\",\"_app/immutable/chunks/empty-list.ac357487.js\",\"_app/immutable/chunks/item-list.b5e17376.js\",\"_app/immutable/chunks/dropmenu.8d41ac65.js\",\"_app/immutable/chunks/index.b48e78f2.js\"];\nexport const stylesheets = [\"_app/immutable/assets/_page.7026acd8.css\",\"_app/immutable/assets/coverslipTable.aa708c95.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;;;;;;;;AASA,SAAS,MAAM,CAAC,GAAG,EAAE;AACrB,EAAE,IAAI;AACN,IAAI,EAAE,CAAC,SAAS,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;AAC3C,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,IAAI,GAAG,CAAC,IAAI,KAAK,QAAQ;AAC7B,MAAM,OAAO;AACb,IAAI,MAAM,GAAG,CAAC;AACd,GAAG;AACH,CAAC;AACD,SAAS,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAE;AAC/B,EAAE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC;AACjC,EAAE,EAAE,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;AACnC,CAAC;AACD,SAAS,IAAI,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,EAAE;AAClC,EAAE,OAAO;AACT,IAAI,KAAK,EAAE,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC;AACzC,MAAM,KAAK,EAAE;AACb,QAAQ,WAAW,EAAE,MAAM,CAAC,WAAW;AACvC,QAAQ,eAAe,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE;AACvC,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,SAAS,EAAE,IAAI;AACvB,OAAO;AACP,KAAK,CAAC;AACN,GAAG,CAAC;AACJ,CAAC;AACD,MAAM,OAAO,GAAG;AAChB,EAAE,MAAM,GAAG,CAAC,KAAK,EAAE;AACnB,IAAI,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC;AACtC,IAAI,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,QAAQ,EAAE,CAAC;AAC9C,IAAI,MAAM,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;AACpD,IAAI,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;AACzC,MAAM,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC;AACvB,KAAK;AACL,IAAI,MAAM,KAAK,GAAG,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;AAC3C,IAAI,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;AAC9B,MAAM,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;AACpC,QAAQ,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC;AACzB,OAAO;AACP,MAAM,MAAM,EAAE,GAAG,MAAM,EAAE,CAAC;AAC1B,MAAM,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,CAAC,CAAC;AACxD,MAAM,MAAM,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,WAAW,EAAE,CAAC,CAAC;AAC3D,MAAM,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;AAC9B,MAAM,MAAM,MAAM,CAAC,aAAa,CAAC,MAAM,CAAC;AACxC,QAAQ,IAAI,EAAE;AACd,UAAU,EAAE;AACZ,UAAU,WAAW;AACrB,UAAU,eAAe,EAAE,MAAM,CAAC,IAAI,CAAC,EAAE;AACzC,UAAU,IAAI,EAAE,IAAI,CAAC,IAAI;AACzB,UAAU,IAAI,EAAE,IAAI,CAAC,IAAI;AACzB,SAAS;AACT,OAAO,CAAC,CAAC,IAAI,CAAC,MAAM;AACpB,QAAQ,sBAAsB,CAAC,KAAK,EAAE,CAAC,WAAW,EAAE,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;AACzE,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,KAAK;AAC3B,QAAQ,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AAC9B,OAAO,CAAC,CAAC;AACT,KAAK;AACL,GAAG;AACH,EAAE,MAAM,MAAM,CAAC,KAAK,EAAE;AACtB,IAAI,MAAM,QAAQ,GAAG,MAAM,CAAC,WAAW,CAAC,MAAM,KAAK,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;AACxE,IAAI,MAAM,WAAW,GAAG,iBAAiB,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;AAC9D,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,EAAE;AAC9B,MAAM,OAAO,IAAI,CAAC,GAAG,EAAE,WAAW,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;AACrD,KAAK;AACL,IAAI,MAAM,MAAM,CAAC,aAAa,CAAC,MAAM,CAAC;AACtC,MAAM,KAAK,EAAE;AACb,QAAQ,EAAE,EAAE,WAAW,CAAC,IAAI,CAAC,EAAE;AAC/B,OAAO;AACP,KAAK,CAAC,CAAC;AACP,GAAG;AACH,CAAC;;;;;;;;AC7EW,MAAC,KAAK,GAAG,EAAE;AACX,MAAC,SAAS,GAAG,YAAY,CAAC,MAAM,OAAO,4BAA4E,CAAC,EAAE,QAAQ;AAC9H,MAAC,IAAI,GAAG,yFAAyF;AAEjG,MAAC,SAAS,GAAG,uEAAuE;AACpF,MAAC,OAAO,GAAG,CAAC,wFAAwF,CAAC,yCAAyC,CAAC,gFAAgF,CAAC,yCAAyC,CAAC,8CAA8C,CAAC,+CAA+C,CAAC,yCAAyC,CAAC,8CAA8C,CAAC,6CAA6C,CAAC,4CAA4C,CAAC,yCAAyC,EAAE;AACxkB,MAAC,WAAW,GAAG,CAAC,0CAA0C,CAAC,mDAAmD,EAAE;AAChH,MAAC,KAAK,GAAG;;;;"}