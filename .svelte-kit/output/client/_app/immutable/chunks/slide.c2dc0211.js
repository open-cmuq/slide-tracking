import{S as $,i as ee,s as te,e as W,b as Y,w as ae,d as y,f as fe,g as B,h as m,W as ue,t as ce,D as q,k as I,l as S,m as k,p as d,R as h,q as E,T as H,F as z,G as U,H as T,U as se,V as le,a as de,c as he,I as F,J as me,a1 as j,a2 as K}from"./index.79e82b19.js";import{k as _e}from"./coverslipTable.svelte_svelte_type_style_lang.6429d3c8.js";import{p as pe}from"./stores.2aba5b55.js";function ve(i){let e,s,n,f,r;const a=i[11].default,o=q(a,i,i[10],null);return{c(){e=I("div"),o&&o.c(),this.h()},l(t){e=S(t,"DIV",{class:!0});var l=k(e);o&&o.l(l),l.forEach(m),this.h()},h(){d(e,"class","coverslip svelte-8acoe0"),h(e,"active",i[0]),h(e,"round",i[6]==="round"),h(e,"draggable",i[1]),E(e,"--pos-x",i[5]),E(e,"--pos-y",i[4])},m(t,l){Y(t,e,l),o&&o.m(e,null),n=!0,f||(r=[H(i[7].call(null,e)),H(s=i[8].call(null,e,i[3]))],f=!0)},p(t,l){o&&o.p&&(!n||l&1024)&&z(o,a,t,t[10],n?T(a,t[10],l,null):U(t[10]),null),s&&se(s.update)&&l&8&&s.update.call(null,t[3]),(!n||l&1)&&h(e,"active",t[0]),(!n||l&64)&&h(e,"round",t[6]==="round"),(!n||l&2)&&h(e,"draggable",t[1]),l&32&&E(e,"--pos-x",t[5]),l&16&&E(e,"--pos-y",t[4])},i(t){n||(B(o,t),n=!0)},o(t){y(o,t),n=!1},d(t){t&&m(e),o&&o.d(t),f=!1,le(r)}}}function ge(i){let e,s,n,f,r;const a=i[11].default,o=q(a,i,i[10],null);return{c(){e=I("a"),o&&o.c(),this.h()},l(t){e=S(t,"A",{href:!0,class:!0});var l=k(e);o&&o.l(l),l.forEach(m),this.h()},h(){d(e,"href",i[2]),d(e,"class","coverslip svelte-8acoe0"),h(e,"active",i[0]),h(e,"round",i[6]==="round"),h(e,"draggable",i[1]),E(e,"--pos-x",i[5]),E(e,"--pos-y",i[4])},m(t,l){Y(t,e,l),o&&o.m(e,null),n=!0,f||(r=[H(i[7].call(null,e)),H(s=i[8].call(null,e,i[3]))],f=!0)},p(t,l){o&&o.p&&(!n||l&1024)&&z(o,a,t,t[10],n?T(a,t[10],l,null):U(t[10]),null),(!n||l&4)&&d(e,"href",t[2]),s&&se(s.update)&&l&8&&s.update.call(null,t[3]),(!n||l&1)&&h(e,"active",t[0]),(!n||l&64)&&h(e,"round",t[6]==="round"),(!n||l&2)&&h(e,"draggable",t[1]),l&32&&E(e,"--pos-x",t[5]),l&16&&E(e,"--pos-y",t[4])},i(t){n||(B(o,t),n=!0)},o(t){y(o,t),n=!1},d(t){t&&m(e),o&&o.d(t),f=!1,le(r)}}}function be(i){let e,s,n,f;const r=[ge,ve],a=[];function o(t,l){return t[2]?0:1}return e=o(i),s=a[e]=r[e](i),{c(){s.c(),n=W()},l(t){s.l(t),n=W()},m(t,l){a[e].m(t,l),Y(t,n,l),f=!0},p(t,[l]){let c=e;e=o(t),e===c?a[e].p(t,l):(ae(),y(a[c],1,1,()=>{a[c]=null}),fe(),s=a[e],s?s.p(t,l):(s=a[e]=r[e](t),s.c()),B(s,1),s.m(n.parentNode,n))},i(t){f||(B(s),f=!0)},o(t){y(s),f=!1},d(t){a[e].d(t),t&&m(n)}}}const O=.275,Z=.125,we=.725,Ee=.875;function Ce(i,e,s){let n,f,r,{$$slots:a={},$$scope:o}=e,{active:t=!1}=e,{draggable:l=!1}=e,{href:c=""}=e,{position:A="drag"}=e,{coverslip:p}=e;const Q=ue();function ie(u){let N,M,R,C,P,X;function _(b){if(!l)return;u.classList.add("dragging");const w=u.getBoundingClientRect();N=b.clientX-u.offsetLeft+w.width/2,M=b.clientY-u.offsetTop+w.height/2,u.setPointerCapture(b.pointerId),u.addEventListener("pointermove",v),u.addEventListener("pointerup",g)}function v(b){const D=u.parentNode.getBoundingClientRect(),L=u.getBoundingClientRect(),G=L.width/2,J=L.height/2,ne=D.width-L.width+G,re=D.height-L.height+J;R=b.clientX-N+L.width/2,C=b.clientY-M+L.height/2,R=Math.max(G,Math.min(R,ne)),C=Math.max(J,Math.min(C,re)),P=R/D.width,X=C/D.height,u.style.setProperty("--pos-x",`${P}`),u.style.setProperty("--pos-y",`${X}`)}function g(b){Q("position",{positionX:Number(P.toFixed(3)),positionY:Number(X.toFixed(3))}),u.classList.remove("dragging"),u.removeEventListener("pointermove",v),u.removeEventListener("pointerup",g)}return u.addEventListener("pointerdown",_),{destroy(){u.removeEventListener("pointerdown",_),u.removeEventListener("pointermove",v),u.removeEventListener("pointerup",g)}}}function oe(u,N){function M(R){if(R!=="auto")return;const C=u.getAttribute("style")||"",P=u.parentNode,X=Array.from(P.children).filter(_=>_!==u).map(_=>_.getBoundingClientRect());e:for(let _=O;_<we;_+=.1)for(let v=Z;v<Ee;v+=.1){u.setAttribute("style",`
						${C};
						left: ${(_*100).toFixed(1)}%;
						top: ${(v*100).toFixed(1)}%;
					`);const g=u.getBoundingClientRect();if(!X.some(w=>g.right>w.left&&g.left<w.right&&g.bottom>w.top&&g.top<w.bottom)){s(5,n=Number(_.toFixed(3))),s(4,f=Number(v.toFixed(3))),Q("position",{positionX:n,positionY:f});break e}}u.setAttribute("style",C)}return ce().then(()=>{M(N)}),{update:M}}return i.$$set=u=>{"active"in u&&s(0,t=u.active),"draggable"in u&&s(1,l=u.draggable),"href"in u&&s(2,c=u.href),"position"in u&&s(3,A=u.position),"coverslip"in u&&s(9,p=u.coverslip),"$$scope"in u&&s(10,o=u.$$scope)},i.$$.update=()=>{i.$$.dirty&512&&s(5,{positionX:n=O,positionY:f=Z,shape:r="round"}=p,n,(s(4,f),s(9,p)),(s(6,r),s(9,p)))},[t,l,c,A,f,n,r,ie,oe,p,o,a]}class Ie extends ${constructor(e){super(),ee(this,e,Ce,be,te,{active:0,draggable:1,href:2,position:3,coverslip:9})}}function V(i,e,s){let n=i+e;return typeof s<"u"&&(n+=` ${s}`),n}function ke(i){const{data:e,size:s,margin:n=0}=i;let f="",r=0,a=!1,o=0;for(let t=0;t<e.length;t++){const l=Math.floor(t%s),c=Math.floor(t/s);!l&&!a&&(a=!0),e[t]?(o++,t>0&&l>0&&e[t-1]||(f+=a?V("M",l+n,.5+c+n):V("m",r,0),r=0,a=!1),l+1<s&&e[t+1]||(f+=V("h",o),o=0)):r++}return f}function Re(i,e){const s=new URL(`${i.protocol}//${i.host}`);s.pathname=`/slide/${e}`;const n=_e(s.href,{errorCorrectionLevel:"H"}),{data:f,size:r}=n.modules;return{svgSize:r,svgPath:ke({data:Array.from(f),size:r})}}function x(i){let e,s,n,f;return{c(){e=j("svg"),s=j("path"),this.h()},l(r){e=K(r,"svg",{id:!0,viewBox:!0,class:!0});var a=k(e);s=K(a,"path",{d:!0,class:!0}),k(s).forEach(m),a.forEach(m),this.h()},h(){d(s,"d",i[1]),d(s,"class","svelte-mwm18m"),d(e,"id",n="id"+i[0]),d(e,"viewBox",f="0 0 "+i[2]+" "+i[2]),d(e,"class","print svelte-mwm18m")},m(r,a){Y(r,e,a),F(e,s)},p(r,a){a&2&&d(s,"d",r[1]),a&1&&n!==(n="id"+r[0])&&d(e,"id",n),a&4&&f!==(f="0 0 "+r[2]+" "+r[2])&&d(e,"viewBox",f)},d(r){r&&m(e)}}}function Le(i){let e,s,n,f,r;const a=i[4].default,o=q(a,i,i[3],null);let t=i[0]&&x(i);return{c(){e=I("div"),s=I("div"),o&&o.c(),n=de(),f=I("div"),t&&t.c(),this.h()},l(l){e=S(l,"DIV",{class:!0});var c=k(e);s=S(c,"DIV",{class:!0});var A=k(s);o&&o.l(A),A.forEach(m),n=he(c),f=S(c,"DIV",{class:!0});var p=k(f);t&&t.l(p),p.forEach(m),c.forEach(m),this.h()},h(){d(s,"class","slide-surface svelte-mwm18m"),d(f,"class","slide-label svelte-mwm18m"),d(e,"class","slide svelte-mwm18m")},m(l,c){Y(l,e,c),F(e,s),o&&o.m(s,null),F(e,n),F(e,f),t&&t.m(f,null),r=!0},p(l,[c]){o&&o.p&&(!r||c&8)&&z(o,a,l,l[3],r?T(a,l[3],c,null):U(l[3]),null),l[0]?t?t.p(l,c):(t=x(l),t.c(),t.m(f,null)):t&&(t.d(1),t=null)},i(l){r||(B(o,l),r=!0)},o(l){y(o,l),r=!1},d(l){l&&m(e),o&&o.d(l),t&&t.d()}}}function Ae(i,e,s){let n;me(i,pe,c=>s(5,n=c));let{$$slots:f={},$$scope:r}=e,{slideId:a=""}=e,o,t;function l(c){c&&s(1,{svgPath:o,svgSize:t}=Re(n.url,c),o,s(2,t))}return i.$$set=c=>{"slideId"in c&&s(0,a=c.slideId),"$$scope"in c&&s(3,r=c.$$scope)},i.$$.update=()=>{i.$$.dirty&1&&l(a)},[a,o,t,r,f]}class Se extends ${constructor(e){super(),ee(this,e,Ae,Le,te,{slideId:0})}}export{Ie as C,Se as S,Re as c};
