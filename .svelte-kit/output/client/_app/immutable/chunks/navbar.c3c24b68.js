import{S as W,i as G,s as z,D as ue,k as $,a as E,l as k,m as y,c as I,h as p,p as C,b as T,I as v,F as de,G as me,H as he,g as S,d as R,r as q,u as A,v as pe,R as re,T as Oe,W as Ue,Z as Pe,n as _e,x as Q,e as ae,w as ge,f as we,z as U,A as P,q as Ve,B as V,N as Y,U as Be,C as B,K as Le,L as qe,J as Ae}from"./index.79e82b19.js";import{h as je,M as x,i as Me,j as He}from"./coverslipTable.svelte_svelte_type_style_lang.6429d3c8.js";import{D as Ne,P as Fe,A as Qe}from"./popup.dbbce627.js";import{p as We}from"./stores.2aba5b55.js";import{B as Ge}from"./button-item.6bf52554.js";import{_ as ze}from"./preload-helper.41c905a7.js";function ie(r){let e,n;return{c(){e=$("div"),n=q(r[0]),this.h()},l(t){e=k(t,"DIV",{class:!0});var o=y(e);n=A(o,r[0]),o.forEach(p),this.h()},h(){C(e,"class","title svelte-1aos8qp")},m(t,o){T(t,e,o),v(e,n)},p(t,o){o&1&&pe(n,t[0])},d(t){t&&p(e)}}}function Xe(r){let e,n,t,o,s=r[0]&&ie(r);const c=r[2].default,a=ue(c,r,r[1],null);return{c(){e=$("section"),s&&s.c(),n=E(),t=$("div"),a&&a.c(),this.h()},l(i){e=k(i,"SECTION",{});var l=y(e);s&&s.l(l),n=I(l),t=k(l,"DIV",{class:!0});var m=y(t);a&&a.l(m),m.forEach(p),l.forEach(p),this.h()},h(){C(t,"class","items svelte-1aos8qp")},m(i,l){T(i,e,l),s&&s.m(e,null),v(e,n),v(e,t),a&&a.m(t,null),o=!0},p(i,[l]){i[0]?s?s.p(i,l):(s=ie(i),s.c(),s.m(e,n)):s&&(s.d(1),s=null),a&&a.p&&(!o||l&2)&&de(a,c,i,i[1],o?he(c,i[1],l,null):me(i[1]),null)},i(i){o||(S(a,i),o=!0)},o(i){R(a,i),o=!1},d(i){i&&p(e),s&&s.d(),a&&a.d(i)}}}function Je(r,e,n){let{$$slots:t={},$$scope:o}=e,{title:s=""}=e;return r.$$set=c=>{"title"in c&&n(0,s=c.title),"$$scope"in c&&n(1,o=c.$$scope)},[s,o,t]}class Rt extends W{constructor(e){super(),G(this,e,Je,Xe,z,{title:0})}}async function Ke(r,e,n){const{callbackUrl:t=window.location.href,redirect:o=!0}=e??{},s=r==="credentials",a=s||r==="email",l=`${`/auth/${s?"callback":"signin"}/${r}`}?${new URLSearchParams(n)}`,m=await fetch("/auth/csrf"),{csrfToken:f}=await m.json(),h=await fetch(l,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({...e,csrfToken:f,callbackUrl:t})}),d=await h.clone().json(),u=new URL(d.url).searchParams.get("error");if(o||!a||!u){window.location.href=d.url??t,d.url.includes("#")&&window.location.reload();return}return h}async function Ze(r){const{callbackUrl:e=window.location.href}=r??{},n=await fetch("/auth/csrf"),{csrfToken:t}=await n.json(),c=(await(await fetch("/auth/signout",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({csrfToken:t,callbackUrl:e})})).json()).url??e;window.location.href=c,c.includes("#")&&window.location.reload()}const Ye="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12C5,7.9 8.2,4.73 12.2,4.73C15.29,4.73 17.1,6.7 17.1,6.7L19,4.72C19,4.72 16.56,2 12.1,2C6.42,2 2.03,6.8 2.03,12C2.03,17.05 6.16,22 12.25,22C17.6,22 21.5,18.33 21.5,12.91C21.5,11.76 21.35,11.1 21.35,11.1V11.1";class xe extends Error{constructor(){super("camera access is only permitted in secure context. Use HTTPS or localhost rather than HTTP."),this.name="InsecureContextError"}}class et extends Error{constructor(){super("this browser has no Stream API support"),this.name="StreamApiNotSupportedError"}}class tt{constructor(e,n){this.videoEl=e,this.stream=n}stop(){this.videoEl.srcObject=null,this.stream.getTracks().forEach(e=>{this.stream.removeTrack(e),e.stop()})}getCapabilities(){var n;const[e]=this.stream.getVideoTracks();return((n=e==null?void 0:e.getCapabilities)==null?void 0:n.call(e))??{}}}const nt=async r=>{const e=["OBS Virtual Camera","OBS-Camera"],n=(await navigator.mediaDevices.enumerateDevices()).filter(({kind:t})=>t==="videoinput").filter(({label:t})=>!e.includes(t)).filter(({label:t})=>!t.includes("infrared"));if(n.length>2){const t=n[0],o=n[n.length-1];switch(r){case"auto":return{deviceId:{exact:o.deviceId}};case"rear":return{deviceId:{exact:o.deviceId}};case"front":return{deviceId:{exact:t.deviceId}};default:return}}else switch(r){case"auto":return{facingMode:{ideal:"environment"}};case"rear":return{facingMode:{exact:"environment"}};case"front":return{facingMode:{exact:"user"}};default:return}};async function st(r,{camera:e}){var o;if(window.isSecureContext!==!0)throw new xe;if(((o=navigator==null?void 0:navigator.mediaDevices)==null?void 0:o.getUserMedia)===void 0)throw new et;const n={audio:!1,video:{width:{min:360,ideal:640,max:1920},height:{min:240,ideal:360,max:1080},...await nt(e)}},t=await navigator.mediaDevices.getUserMedia(n);return r.srcObject!==void 0?r.srcObject=t:r.mozSrcObject!==void 0?r.mozSrcObject=t:window.URL.createObjectURL?r.src=window.URL.createObjectURL(t):window.webkitURL?r.src=window.webkitURL.createObjectURL(t):r.src=t,await new Promise(s=>{r.addEventListener("loadeddata",s)}),await new Promise(s=>{setTimeout(s,500)}),new tt(r,t)}const ot=r=>{if(r.length>0){const[e]=r,[n,t,o,s]=e.cornerPoints;return{content:e.rawValue,location:{topLeftCorner:n,topRightCorner:t,bottomRightCorner:o,bottomLeftCorner:s},imageData:null}}else return{content:null,location:null,imageData:null}},rt=(r,e)=>{const n=new BarcodeDetector({formats:["qr_code"]}),{detectHandler:t,locateHandler:o,minDelay:s}=e,c=a=>async i=>{if(r.readyState>1){const{lastScanned:l,contentBefore:m,locationBefore:f}=a;if(i-l>=s){const h=await n.detect(r),{content:d,location:u,imageData:w}=ot(h);d!==null&&d!==m&&t({content:d,location:u,imageData:w}),(u!==null||f!==null)&&o(h),window.requestAnimationFrame(c({lastScanned:i,contentBefore:d??m,locationBefore:u}))}else window.requestAnimationFrame(c(a))}};c({contentBefore:null,locationBefore:null,lastScanned:performance.now()})()};function le(r){let e;return{c(){e=$("canvas"),this.h()},l(n){e=k(n,"CANVAS",{class:!0}),y(e).forEach(p),this.h()},h(){C(e,"class","qrcode-stream-camera svelte-1abpb2t")},m(n,t){T(n,e,t),r[11](e)},p:_e,d(n){n&&p(e),r[11](null)}}}function at(r){let e,n,t,o,s,c,a,i,l,m,f=!r[3]&&le(r);const h=r[9].default,d=ue(h,r,r[8],null);return{c(){e=$("div"),n=$("video"),t=E(),f&&f.c(),o=E(),s=$("canvas"),c=E(),a=$("div"),d&&d.c(),this.h()},l(u){e=k(u,"DIV",{class:!0});var w=y(e);n=k(w,"VIDEO",{class:!0});var M=y(n);M.forEach(p),t=I(w),f&&f.l(w),o=I(w),s=k(w,"CANVAS",{class:!0}),y(s).forEach(p),c=I(w),a=k(w,"DIV",{class:!0});var j=y(a);d&&d.l(j),j.forEach(p),w.forEach(p),this.h()},h(){C(n,"class","qrcode-stream-camera svelte-1abpb2t"),n.autoplay=!0,n.muted=!0,n.playsInline=!0,C(s,"class","qrcode-stream-overlay svelte-1abpb2t"),C(a,"class","qrcode-stream-overlay svelte-1abpb2t"),C(e,"class","qrcode-stream-wrapper svelte-1abpb2t"),re(e,"qrcode-stream-camera--hidden",!r[3])},m(u,w){T(u,e,w),v(e,n),r[10](n),v(e,t),f&&f.m(e,null),v(e,o),v(e,s),r[12](s),v(e,c),v(e,a),d&&d.m(a,null),i=!0,l||(m=Oe(r[4].call(null,n)),l=!0)},p(u,[w]){u[3]?f&&(f.d(1),f=null):f?f.p(u,w):(f=le(u),f.c(),f.m(e,o)),d&&d.p&&(!i||w&256)&&de(d,h,u,u[8],i?he(h,u[8],w,null):me(u[8]),null),(!i||w&8)&&re(e,"qrcode-stream-camera--hidden",!u[3])},i(u){i||(S(d,u),i=!0)},o(u){R(d,u),i=!1},d(u){u&&p(e),r[10](null),f&&f.d(),r[12](null),d&&d.d(u),l=!1,m()}}}function Z(r){r.getContext("2d").clearRect(0,0,r.width,r.height)}function it(r,e,n){let t,{$$slots:o={},$$scope:s}=e;const c=Ue();function a(_){const{content:b}=_;c("detect",b)}let{camera:i="auto"}=e,{track:l=void 0}=e,m=null,f=!1,h,d,u;function w(){m!==null&&(m.stop(),n(7,m=null))}function M(_){if("BarcodeDetector"in window||ze(()=>import("./index.c907e73c.js"),[],import.meta.url).then(b=>{window.BarcodeDetector=b.default}),i==="off")n(7,m=null);else try{st(_,{camera:i}).then(b=>{n(7,m=b),f&&m.stop()})}catch(b){console.error({error:b})}}function j(){Z(d),Z(h),rt(u,{detectHandler:a,locateHandler:O,minDelay:500})}function O(_){const b=h;if(b!==void 0)if(_.length>0&&l&&u){const N=u.offsetWidth,ee=u.offsetHeight,X=u.videoWidth,J=u.videoHeight,te=Math.max(N/X,ee/J),ne=X*te,se=J*te,ve=ne/X,be=se/J,$e=(N-ne)/2,ke=(ee-se)/2,K=({x:H,y:L})=>({x:Math.floor(H*ve),y:Math.floor(L*be)}),oe=({x:H,y:L})=>({x:Math.floor(H+$e),y:Math.floor(L+ke)}),ye=_.map(H=>{const{boundingBox:L,cornerPoints:Se}=H,{x:De,y:Re}=oe(K({x:L.x,y:L.y})),{x:Te,y:Ee}=K({x:L.width,y:L.height});return{...H,cornerPoints:Se.map(Ie=>oe(K(Ie))),boundingBox:DOMRectReadOnly.fromRect({x:De,y:Re,width:Te,height:Ee})}});b.width=u.offsetWidth,b.height=u.offsetHeight;const Ce=b.getContext("2d");l(ye,Ce)}else Z(b)}Pe(()=>{w(),f=!0});function F(_){Q[_?"unshift":"push"](()=>{u=_,n(2,u)})}function g(_){Q[_?"unshift":"push"](()=>{d=_,n(1,d)})}function D(_){Q[_?"unshift":"push"](()=>{h=_,n(0,h)})}return r.$$set=_=>{"camera"in _&&n(5,i=_.camera),"track"in _&&n(6,l=_.track),"$$scope"in _&&n(8,s=_.$$scope)},r.$$.update=()=>{r.$$.dirty&128&&n(3,t=m!==null),r.$$.dirty&128&&m!==null&&j()},[h,d,u,t,M,i,l,m,s,o,F,g,D]}class lt extends W{constructor(e){super(),G(this,e,it,at,z,{camera:5,track:6})}}function ce(r){let e,n,t,o,s,c,a,i,l,m;t=new lt({props:{track:ft}}),t.$on("detect",r[3]);let f=r[2]&&fe();return{c(){e=$("div"),n=$("div"),U(t.$$.fragment),o=E(),f&&f.c(),s=E(),c=$("button"),a=q("Close"),this.h()},l(h){e=k(h,"DIV",{class:!0});var d=y(e);n=k(d,"DIV",{class:!0});var u=y(n);P(t.$$.fragment,u),o=I(u),f&&f.l(u),s=I(u),c=k(u,"BUTTON",{style:!0});var w=y(c);a=A(w,"Close"),w.forEach(p),u.forEach(p),d.forEach(p),this.h()},h(){Ve(c,"margin","5px 45%"),C(n,"class","dialog svelte-9jaqf2"),C(e,"class","dialog-overlay svelte-9jaqf2")},m(h,d){T(h,e,d),v(e,n),V(t,n,null),v(n,o),f&&f.m(n,null),v(n,s),v(n,c),v(c,a),i=!0,l||(m=Y(c,"click",function(){Be(r[1])&&r[1].apply(this,arguments)}),l=!0)},p(h,d){r=h,r[2]?f||(f=fe(),f.c(),f.m(n,s)):f&&(f.d(1),f=null)},i(h){i||(S(t.$$.fragment,h),i=!0)},o(h){R(t.$$.fragment,h),i=!1},d(h){h&&p(e),B(t),f&&f.d(),l=!1,m()}}}function fe(r){let e,n;return{c(){e=$("div"),n=q("Detected QR Code is not a valid slide."),this.h()},l(t){e=k(t,"DIV",{class:!0});var o=y(e);n=A(o,"Detected QR Code is not a valid slide."),o.forEach(p),this.h()},h(){C(e,"class","invalid")},m(t,o){T(t,e,o),v(e,n)},d(t){t&&p(e)}}}function ct(r){let e,n,t=r[0]&&ce(r);return{c(){t&&t.c(),e=ae()},l(o){t&&t.l(o),e=ae()},m(o,s){t&&t.m(o,s),T(o,e,s),n=!0},p(o,[s]){o[0]?t?(t.p(o,s),s&1&&S(t,1)):(t=ce(o),t.c(),S(t,1),t.m(e.parentNode,e)):t&&(ge(),R(t,1,1,()=>{t=null}),we())},i(o){n||(S(t),n=!0)},o(o){R(t),n=!1},d(o){t&&t.d(o),o&&p(e)}}}function ft(r,e){for(const n of r){const[t,...o]=n.cornerPoints;e.strokeStyle="red",e.beginPath(),e.moveTo(t.x,t.y);for(const{x:s,y:c}of o)e.lineTo(s,c);e.lineTo(t.x,t.y),e.closePath(),e.stroke()}}function ut(r,e,n){let{show:t=!1}=e,{close:o}=e,s=!1;function c(a){const{detail:i}=a,l=i.split("/");if(l[l.length-2]=="slide"){const m=l[l.length-1];je(`/slide/${m}`),n(0,t=!1)}n(2,s=l[l.length-2]!="slide")}return r.$$set=a=>{"show"in a&&n(0,t=a.show),"close"in a&&n(1,o=a.close)},[t,o,s,c]}class dt extends W{constructor(e){super(),G(this,e,ut,ct,z,{show:0,close:1})}}function mt(r){let e,n,t,o,s,c;return n=new x({props:{d:Ye}}),{c(){e=$("button"),U(n.$$.fragment),t=q(`
                Sign in with Google`),this.h()},l(a){e=k(a,"BUTTON",{class:!0});var i=y(e);P(n.$$.fragment,i),t=A(i,`
                Sign in with Google`),i.forEach(p),this.h()},h(){C(e,"class","br-button-primary")},m(a,i){T(a,e,i),V(n,e,null),v(e,t),o=!0,s||(c=Y(e,"click",r[6]),s=!0)},p:_e,i(a){o||(S(n.$$.fragment,a),o=!0)},o(a){R(n.$$.fragment,a),o=!1},d(a){a&&p(e),B(n),s=!1,c()}}}function ht(r){let e,n;return e=new Ne({props:{$$slots:{trigger:[wt],default:[gt]},$$scope:{ctx:r}}}),{c(){U(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){V(e,t,o),n=!0},p(t,o){const s={};o&259&&(s.$$scope={dirty:o,ctx:t}),e.$set(s)},i(t){n||(S(e.$$.fragment,t),n=!0)},o(t){R(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function pt(r){let e;return{c(){e=q("Sign Out")},l(n){e=A(n,"Sign Out")},m(n,t){T(n,e,t)},d(n){n&&p(e)}}}function _t(r){let e,n,t,o;return e=new Qe({}),t=new Ge({props:{$$slots:{default:[pt]},$$scope:{ctx:r}}}),t.$on("click",Ze),{c(){U(e.$$.fragment),n=E(),U(t.$$.fragment)},l(s){P(e.$$.fragment,s),n=I(s),P(t.$$.fragment,s)},m(s,c){V(e,s,c),T(s,n,c),V(t,s,c),o=!0},p(s,c){const a={};c&256&&(a.$$scope={dirty:c,ctx:s}),t.$set(a)},i(s){o||(S(e.$$.fragment,s),S(t.$$.fragment,s),o=!0)},o(s){R(e.$$.fragment,s),R(t.$$.fragment,s),o=!1},d(s){B(e,s),s&&p(n),B(t,s)}}}function gt(r){let e,n,t,o,s,c,a,i;return n=new x({props:{d:He}}),s=new Fe({props:{$$slots:{default:[_t]},$$scope:{ctx:r}}}),{c(){e=$("button"),U(n.$$.fragment),t=q(`
                    Scan QR Code`),o=E(),U(s.$$.fragment)},l(l){e=k(l,"BUTTON",{});var m=y(e);P(n.$$.fragment,m),t=A(m,`
                    Scan QR Code`),m.forEach(p),o=I(l),P(s.$$.fragment,l)},m(l,m){T(l,e,m),V(n,e,null),v(e,t),T(l,o,m),V(s,l,m),c=!0,a||(i=Y(e,"click",r[5]),a=!0)},p(l,m){const f={};m&256&&(f.$$scope={dirty:m,ctx:l}),s.$set(f)},i(l){c||(S(n.$$.fragment,l),S(s.$$.fragment,l),c=!0)},o(l){R(n.$$.fragment,l),R(s.$$.fragment,l),c=!1},d(l){l&&p(e),B(n),l&&p(o),B(s,l),a=!1,i()}}}function wt(r){let e,n=r[1].name+"",t;return{c(){e=$("div"),t=q(n),this.h()},l(o){e=k(o,"DIV",{slot:!0,class:!0});var s=y(e);t=A(s,n),s.forEach(p),this.h()},h(){C(e,"slot","trigger"),C(e,"class","br-list-item")},m(o,s){T(o,e,s),v(e,t)},p(o,s){s&2&&n!==(n=o[1].name+"")&&pe(t,n)},d(o){o&&p(e)}}}function vt(r){let e,n,t,o,s,c,a,i,l,m,f,h,d,u;function w(g){r[4](g)}let M={close:r[2]};r[0]!==void 0&&(M.show=r[0]),e=new dt({props:M}),Q.push(()=>Le(e,"show",w)),c=new x({props:{d:Me}});const j=[ht,mt],O=[];function F(g,D){return g[1]?0:1}return h=F(r),d=O[h]=j[h](r),{c(){U(e.$$.fragment),t=E(),o=$("nav"),s=$("a"),U(c.$$.fragment),a=E(),i=$("div"),l=q("Slide Tracking"),m=E(),f=$("div"),d.c(),this.h()},l(g){P(e.$$.fragment,g),t=I(g),o=k(g,"NAV",{class:!0});var D=y(o);s=k(D,"A",{class:!0,href:!0});var _=y(s);P(c.$$.fragment,_),a=I(_),i=k(_,"DIV",{class:!0});var b=y(i);l=A(b,"Slide Tracking"),b.forEach(p),_.forEach(p),m=I(D),f=k(D,"DIV",{class:!0});var N=y(f);d.l(N),N.forEach(p),D.forEach(p),this.h()},h(){C(i,"class","word-mark svelte-1lmhyd"),C(s,"class","logo svelte-1lmhyd"),C(s,"href","/"),C(f,"class","actions svelte-1lmhyd"),C(o,"class","svelte-1lmhyd")},m(g,D){V(e,g,D),T(g,t,D),T(g,o,D),v(o,s),V(c,s,null),v(s,a),v(s,i),v(i,l),v(o,m),v(o,f),O[h].m(f,null),u=!0},p(g,[D]){const _={};!n&&D&1&&(n=!0,_.show=g[0],qe(()=>n=!1)),e.$set(_);let b=h;h=F(g),h===b?O[h].p(g,D):(ge(),R(O[b],1,1,()=>{O[b]=null}),we(),d=O[h],d?d.p(g,D):(d=O[h]=j[h](g),d.c()),S(d,1),d.m(f,null))},i(g){u||(S(e.$$.fragment,g),S(c.$$.fragment,g),S(d),u=!0)},o(g){R(e.$$.fragment,g),R(c.$$.fragment,g),R(d),u=!1},d(g){B(e,g),g&&p(t),g&&p(o),B(c),O[h].d()}}}function bt(r,e,n){let t,o;Ae(r,We,m=>n(3,o=m));let s=!1;function c(){n(0,s=!1)}function a(m){s=m,n(0,s)}const i=()=>n(0,s=!0),l=()=>Ke("google");return r.$$.update=()=>{r.$$.dirty&8&&n(1,t=o.data.user)},[s,t,c,o,a,i,l]}class Tt extends W{constructor(e){super(),G(this,e,bt,vt,z,{})}}export{Tt as N,Rt as S};
